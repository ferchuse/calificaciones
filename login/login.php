<?php	header("Content-Type: application/json");	$response= array();	include("../conexi.php");	$link=Conectarse();	$myusername=$_POST['username'];	$mypassword=$_POST['password']; 		// To protect mysqli injection (more detail about mysqli injection)	$myusername = stripslashes($myusername);	$mypassword = stripslashes($mypassword);	/* $myusername = mysqli_real_escape_string($myusername);	$mypassword = mysqli_real_escape_string($mypassword); */		if($_POST['tipo_usuario'] == "admin"){				$sql="SELECT		id_usuarios,		nombre_usuarios,		permiso_usuarios				FROM usuarios 		WHERE nombre_usuarios='$myusername' 		AND pass_usuarios='$mypassword'				";			}	else{				$sql = "SELECT 		*		FROM alumnos		WHERE 		id_alumnos = '$myusername'		AND contrasena='$mypassword'				";	}			$result=mysqli_query($link, $sql);	if (!$result){		die('Error: ' . mysqli_error($link));	}	$count=mysqli_num_rows($result);	// Si la consulta devuelve 1 fila inicia la sesion	if($count==1){		session_start();		session_regenerate_id(true);		$id_sesion = session_id();		$row = mysqli_fetch_assoc($result);		if($_POST['tipo_usuario'] == "admin"){			$nombre_usuario= $row["nombre_usuarios"];			setcookie("id_usuarios", $row["id_usuarios"],  0, "/calificaciones/");		}		else{			$nombre_usuario= $row["nombre_alumno"];			setcookie("id_usuarios",$row["id_alumnos"],  0, "/calificaciones/");			setcookie("nombre_completo",$row["nombre_alumno"]." ".$row["ape_pat"]." ".$row["ape_mat"],  0, "/calificaciones/");			setcookie("grupo",$row["id_grupo"],  0, "/calificaciones/");					}				// $_SESSION["id_usuarios"] = $id_usuario or die("Error al asignar id usuario");		//$_SESSION["usuario"] = $myusername or die("Error al iniciar variables de sesión");		$_SESSION["username"] = $nombre_usuario or die("Error al iniciar username");		// $_SESSION["permisos"] = $row["permiso_usuarios"] or die("Error al iniciar permisos");		$response["login"] = "valid";		// $response["permisos"] = $_SESSION["permisos"];		$response["permisos"] = $_POST["tipo_usuario"];					setcookie("permiso_usuarios", $row["permiso_usuarios"],  0, "/calificaciones/");		setcookie("nombre_usuarios", $nombre_usuario,  0, "/calificaciones/");		// setcookie("id_usuario", $id_usuario,  0, "/");	}	else{		$response["login"] = "invalid";		$response["mensaje"] = "Usuario y/o Contraseña Inválidos";	}	$response["query"] = $sql;	echo json_encode($response);	?>	